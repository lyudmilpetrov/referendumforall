var bgr=angular.module("bgr",["ngRoute","ngResource","ngDialog","ngAnimate","ngAria","mp.autoFocus"]);bgr.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$locationProvider.html5Mode({enabled:true,requireBase:false});$routeProvider.when("/offline",{templateUrl:"Views/offline.html",controller:"bgrCtrlIssue",controllerAs:"C3"});$routeProvider.otherwise({templateUrl:"Views/Start.html",controller:"bgrCtrl"})}]);
bgr.run(["$window","$rootScope",function($window,$rootScope){$rootScope.online=navigator.onLine;$window.addEventListener("offline",function(){$rootScope.$apply(function(){$rootScope.online=false})},false);$window.addEventListener("online",function(){$rootScope.$apply(function(){$rootScope.online=true})},false)}]);

bgr.directive("fileSelect",["$window","$http","globalVariables","ngDialog","getURLData","postURLData",function($window,$http,globalVariables,ngDialog,getURLData,postURLData){return{restrict:"A",require:"ngModel",link:function(scope,el,attr,ctrl){if($window.File&&$window.FileReader&&$window.FileList&&$window.Blob){var deleteFileNow=function(){var d={container:scope.words.abrv+scope.words.genericWords.strg,filename:initials+"/"+selectedFile.name};postURLData(globalVariables.getProperty(0,"deleteAzureStorage").url,
d,globalVariables.getProperty(0,"deleteAzureStorage").contentType).then(function(response){ngDialog.close(ngDialog.getOpenDialogs()[0]);scope.words.track.fileSaved=false;scope.words.fieldsRefLoadedFile.s=false;scope.words.fieldsRefLoadedFile.v=""})["catch"](function(error){console.log("works POST - "+error);ngDialog.close(ngDialog.getOpenDialogs()[0])})};var pad=function(number,length){var str=""+number;while(str.length<length)str="0"+str;return str};var commitBlockList=function(){var uri=submitUri+
"&comp=blocklist";var requestBody='<?xml version="1.0" encoding="utf-8"?><BlockList>';for(var i=0;i<blockIds.length;i++)requestBody+="<Latest>"+blockIds[i]+"</Latest>";requestBody+="</BlockList>";$.ajax({url:uri,type:"PUT",data:requestBody,beforeSend:function(xhr){},success:function(data,status){},error:function(xhr,desc,err){}})};var uploadFileInBlocks=function(){if(totalBytesRemaining>0){var fileContent=selectedFile.slice(currentFilePointer,currentFilePointer+maxBlockSize);var blockId=blockIdPrefix+
pad(blockIds.length,6);blockIds.push(btoa(blockId));reader.readAsArrayBuffer(fileContent);currentFilePointer+=maxBlockSize;totalBytesRemaining-=maxBlockSize;if(totalBytesRemaining<maxBlockSize)maxBlockSize=totalBytesRemaining}else commitBlockList();ngDialog.close(ngDialog.getOpenDialogs()[0]);scope.words.track.fileSaved=true;scope.words.fieldsRefLoadedFile.s=true;scope.words.fieldsRefLoadedFile.v=scope.words.abrv+scope.words.genericWords.strg+":"+initials+":"+selectedFile.name};var handleFileSelect=
function(e){baseUrl=scope.words.track.azr;console.log(baseUrl);blockIds=new Array;initials=(scope.words.fieldsRefTitle.v+scope.words.fieldsRefEmail.v).toLowerCase();maxBlockSize=256*1024;currentFilePointer=0;totalBytesRemaining=0;var files=e.target.files;selectedFile=files[0];var fileSize=selectedFile.size;if(fileSize<maxBlockSize)maxBlockSize=fileSize;totalBytesRemaining=fileSize;if(fileSize%maxBlockSize==0)numberOfBlocks=fileSize/maxBlockSize;else numberOfBlocks=parseInt(fileSize/maxBlockSize,10)+
1;var indexOfQueryStart=baseUrl.indexOf("?");submitUri=baseUrl.substring(0,indexOfQueryStart)+"/"+initials+"/"+selectedFile.name+baseUrl.substring(indexOfQueryStart)};var initials="";var reader=new $window.FileReader;var selectedFile=null;var maxBlockSize=256*1024;var numberOfBlocks=1;var currentFilePointer=0;var totalBytesRemaining=0;var blockIds=new Array;var blockIdPrefix="block-";var submitUri=null;var bytesUploaded=0;var fileSize=0;var fileName;var fileType;var baseUrl;reader.onloadend=function(evt){if(evt.target.readyState==
FileReader.DONE){var setHeader=function(xhr){xhr.setRequestHeader("x-ms-version","2014-02-14");xhr.setRequestHeader("MaxDataServiceVersion","3.0");xhr.setRequestHeader("Accept","application/json;odata=nometadata")};var uri=submitUri+"&comp=block&blockid="+blockIds[blockIds.length-1];console.log(uri);var requestData=new Uint8Array(evt.target.result);$.ajax({url:uri,type:"PUT",data:requestData,processData:false,beforeSend:function(xhr){},success:function(data,status){bytesUploaded+=requestData.length;
var percentComplete=(parseFloat(bytesUploaded)/parseFloat(selectedFile.size)*100).toFixed(2);uploadFileInBlocks()},error:function(xhr,desc,err){}})}};scope.manageFileNow=function(e){if(e=="s"){var p=new Promise(function(resolve,reject){if(!scope.words.track.fileSaved){ngDialog.open({template:'<center><p><img src="Images/l0.gif" alt="loading"> '+scope.words.genericWords.loading+"</p></center>",plain:true,showClose:false,overlay:true,closeByDocument:true,closeByEscape:true,cache:false,trapFocus:false,
preserveFocus:false});resolve(uploadFileInBlocks())}});p.then(function(result){},function(err){$scope.words[key].c="e"})}else{var p$0=new Promise(function(resolve,reject){ngDialog.open({template:'<center><p><img src="Images/l0.gif" alt="loading"> '+scope.words.genericWords.deleteing+"</p></center>",plain:true,showClose:false,overlay:true,closeByDocument:true,closeByEscape:true,cache:false,trapFocus:false,preserveFocus:false});resolve(deleteFileNow())});p$0.then(function(result){},function(err){$scope.words[key].c=
"e"})}};el.bind("change",function(e){if(typeof e.target.files[0]!=="undefined"){selectedFile=e.target.files[0];var ft=attr["fileSelect"];handleFileSelect(e)}})}else;}}}]);

bgr.service("globalVariables",function(){var globalVariables={};globalVariables.storage={};globalVariables.storage.info="info";globalVariables.storage.name="person";globalVariables.storage.type="localStorage";globalVariables.person={};globalVariables.person.firstName="";globalVariables.person.lastName="";globalVariables.person.email="";globalVariables.person.phone="";globalVariables.WebSocketCounter=0;globalVariables.server="https://gdcapi.azurewebsites.net/";globalVariables.hub="/signalr";globalVariables.api=
"api/Referendums";globalVariables.getReferendumsInfo={url:globalVariables.server+globalVariables.api+"/replace",type:"GET",contentType:"application/json;charset=utf-8",data:""};globalVariables.getStorage={url:globalVariables.server+globalVariables.api+"/?option=replace&nation=replace",type:"GET",contentType:"application/json;charset=utf-8",data:""};globalVariables.postReferendumsInfo={url:globalVariables.server+globalVariables.api,type:"POST",contentType:"application/json;charset=utf-8",data:""};
globalVariables.postCodeConfirm={url:globalVariables.server+globalVariables.api+"?codeconfirm=replace",type:"POST",contentType:"application/json;charset=utf-8",data:""};globalVariables.deleteAzureStorage={url:globalVariables.server+globalVariables.api+"?nation=nation",type:"POST",contentType:"application/json;charset=utf-8",data:""};return{getProperty:function(level,key0,key1){if(level===0)return globalVariables[key0];else return globalVariables[key0][key1]},setProperty:function(level,value,key0,
key1){if(level===0)globalVariables[key0]=value;else globalVariables[key0][key1]=value},getObject:function(){return globalVariables}}});bgr.factory("getURLData",function(){return function(url){return new Promise(function(resolve,reject){$.ajax({type:"GET",url:url}).done(resolve).fail(reject)})}});bgr.factory("postURLData",function(){return function(url,data,contentType){return new Promise(function(resolve,reject){$.ajax({type:"POST",data:JSON.stringify(data),url:url,contentType:contentType}).done(resolve).fail(reject)})}});
bgr.factory("words",function(){var commonDataTimeOpen=2500;var bg={fieldsRefTitle:{f:"\u0420\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c \u0437\u0430\u0433\u043b\u0430\u0432\u0438\u0435",r:"\u041c\u043e\u043b\u044f \u0432\u044a\u0432\u0435\u0434\u0435\u0442\u0435 \u0437\u0430\u0433\u043b\u0430\u0432\u0438\u0435  \u043d\u0430 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c",v:"",h:true,l:6},fieldsRefGoals:{f:"\u041a\u0440\u0430\u0442\u043a\u043e \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043d\u0430 \u043c\u043e\u0442\u0438\u0432\u0438\u0442\u0435 \u0438 \u0446\u0435\u043b\u0438\u0442\u0435 \u043d\u0430 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c\u0430",
r:"\u041c\u043e\u043b\u044f \u043a\u0440\u0430\u0442\u043a\u043e \u043e\u043f\u0438\u0448\u0435\u0442\u0435 \u043c\u043e\u0442\u0438\u0432\u0438\u0442\u0435 \u0438 \u0446\u0435\u043b\u0438\u0442\u0435",v:"",h:true,l:10},fieldsRefFirstName:{f:"\u0418\u043c\u0435",r:"\u041c\u043e\u043b\u044f \u0432\u044a\u0432\u0435\u0434\u0435\u0442\u0435 \u0438\u043c\u0435\u0442\u043e \u0441\u0438, \u0449\u0435 \u0431\u044a\u0434\u0435 \u043a\u043e\u0434\u0438\u0440\u0430\u043d\u043e",v:"",h:true,l:0},fieldsRefLastName:{f:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",
r:"\u041c\u043e\u043b\u044f \u0432\u044a\u0432\u0435\u0434\u0435\u0442\u0435 \u0444\u0430\u043c\u0438\u043b\u0438\u044f\u0442\u0430 \u0441\u0438, \u0449\u0435 \u0431\u044a\u0434\u0435 \u043a\u043e\u0434\u0438\u0440\u0430\u043d\u0430",v:"",h:true,l:0},fieldsRefEmail:{f:"\u0422\u0432\u043e\u044f\u0442 \u0435\u043c\u0430\u0439\u043b",r:"\u041c\u043e\u043b\u044f \u0432\u044a\u0432\u0435\u0434\u0435\u0442\u0435 \u0435\u043c\u0430\u0439\u043b, \u0449\u0435 \u0431\u044a\u0434\u0435 \u043a\u043e\u0434\u0438\u0440\u0430\u043d",
v:"",h:true,t:"e",s:false,l:6},fieldsRefPhone:{f:"\u0422\u0432\u043e\u044f\u0442 \u043c\u043e\u0431\u0438\u043b\u0435\u043d \u0442\u0435\u043b\u0435\u0444\u043e\u043d",r:"\u041c\u043e\u043b\u044f \u0432\u044a\u0432\u0435\u0434\u0435\u0442\u0435 \u043c\u043e\u0431\u0438\u043b\u0435\u043d \u0442\u0435\u043b\u0435\u0444\u043e\u043d, \u0449\u0435 \u0431\u044a\u0434\u0435 \u043a\u043e\u0434\u0438\u0440\u0430\u043d",v:"",h:true,t:"s",s:false,l:6},fieldsRefEmailConfirm:{f:"\u0412\u044a\u0432\u0435\u0434\u0438 4 \u0446\u0438\u0444\u0440\u0435\u043d \u043a\u043e\u0434, \u0438\u0437\u043f\u0440\u0430\u0442\u0435\u043d \u043d\u0430 \u0435\u043c\u0430\u0438\u043b\u0430 \u0412\u0438",
r:"\u0412\u044a\u0432\u0435\u0434\u0435\u043d\u0438\u044f\u0442 \u043a\u043e\u0434 \u043d\u0435 \u0441\u044a\u0432\u043f\u0430\u0434\u0430",v:"",h:true,c:false,l:3},fieldsRefPhoneConfirm:{f:"\u0412\u044a\u0432\u0435\u0434\u0438 4 \u0446\u0438\u0444\u0440\u0435\u043d \u043a\u043e\u0434, \u0438\u0437\u043f\u0440\u0430\u0442\u0435\u043d \u043d\u0430 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u0412\u0438",r:"\u0412\u044a\u0432\u0435\u0434\u0435\u043d\u0438\u044f\u0442 \u043a\u043e\u0434 \u043d\u0435 \u0441\u044a\u0432\u043f\u0430\u0434\u0430",
v:"",h:true,c:false,l:3},fieldsRefLoadedFile:{f:"\u0418\u0437\u0431\u0435\u0440\u0438 \u0444\u0430\u0439\u043b",r:"",v:"",h:true,c:false,s:false},fileReferendum:{f:"\u0417\u0430\u0440\u0435\u0434\u0435\u043d \u0444\u0430\u0439\u043b",h:true},registerRef:{f:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0430\u0439 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c",r:false,h:true,ff:"\u0418\u0437\u0442\u0440\u0438\u0439 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c"},
windowTimeOpen:commonDataTimeOpen,phoneExtension:"+359",country:"bulgaria",abrv:"bg",beggingCountry:"\u0420\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c - \u0411\u044a\u043b\u0433\u0430\u0440\u0438\u044f",createRef:"\u041d\u043e\u0432 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c",supportRef:{f:"\u041f\u043e\u0434\u043a\u0440\u0435\u043f\u0438 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c",r:false,h:true,ff:"\u041e\u0442\u0435\u0433\u043b\u0438 \u043f\u043e\u0434\u043a\u0440\u0435\u043f\u0430\u0442\u0430 \u0441\u0438"},
loadFile:{l:"\u0417\u0430\u0440\u0435\u0434\u0438",s:"\u041f\u0440\u0438\u043a\u0430\u0447\u0438",r:"\u0418\u0437\u0442\u0440\u0438",c:"\u041f\u0440\u043e\u043c\u0435\u043d\u0438"},genericWords:{invalidEmail:"\u0412\u0435\u0432\u0435\u0434\u0438 \u0438\u0441\u0442\u0438\u043d\u0441\u043a\u0438 \u0435\u043c\u0430\u0439\u043b",emailMe:"\u041f\u0440\u043e\u0431\u043b\u0435\u043c \u0441\u044a\u0441 \u0432\u0440\u044a\u0437\u043a\u0430\u0442\u0430 \u043c\u043e\u043b\u044f \u043e\u043f\u0442\u0438\u0442\u0430\u0439\u0442\u0435 \u043e\u0442\u043d\u043e\u0432\u043e \u0438 \u0430\u043a\u043e \u0432\u0438\u0434\u0438\u0442\u0435 \u0442\u043e\u0432\u0430 \u0441\u044a\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u0437\u043f\u0440\u0430\u0442\u0435\u0442\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f\u0442\u0430 \u043d\u0430 unitedallpeople@gmail.com \u0438 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c\u0430 \u0449\u0435 \u0431\u044a\u0434\u0435 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0430\u043d \u0438/\u0438\u043b\u0438 \u043f\u043e\u0434\u043a\u0440\u0435\u043f\u0435\u043d \u043e\u0442 \u0432\u0430\u0448\u0435 \u0438\u043c\u0435",
emailSupport:"unitedallpeople@gmail.com",messageSMS:"\u043c\u043e\u043b\u044f \u0438\u0437\u043f\u043e\u043b\u0437\u0432\u0430\u0439\u0442\u0435 \u043a\u043e\u0434 - codereplace - \u0437\u0430 \u0434\u0430 \u043f\u043e\u0442\u0432\u044a\u0440\u0434\u0438\u0442\u0435 \u0412\u0430\u0448\u0438\u044f\u0442 \u0442\u0435\u043b\u0435\u0444\u043e\u043d",messageEmail:"\u043c\u043e\u043b\u044f \u0438\u0437\u043f\u043e\u043b\u0437\u0432\u0430\u0439\u0442\u0435 \u043a\u043e\u0434 - codereplace - \u0437\u0430 \u0434\u0430 \u043f\u043e\u0442\u0432\u044a\u0440\u0434\u0438\u0442\u0435 \u0412\u0430\u0448\u0438\u044f\u0442 \u0435\u043c\u0430\u0439\u043b",
messageEmailSubject:"\u0412\u0430\u0448\u0438\u044f\u0442 \u0435\u043c\u0430\u0439\u043b \u043a\u043e\u0434",fieldLoadingFile:"\u041f\u0440\u0438\u043a\u0430\u0447\u0438 \u0444\u0430\u0439\u043b",strg:"referendum",loading:"\u0417\u0430\u043f\u0430\u043c\u0435\u0442\u044f\u0432\u0430\u043d\u0435...",deleteing:"\u0418\u0437\u0442\u0440\u0438\u0432\u0430\u043d\u0435...",downloading:"\u0418\u0437\u0442\u0435\u0433\u043b\u044f\u043d\u0435...",checking:"\u041f\u0440\u043e\u0432\u0435\u0440\u043a\u0430...",
emailCode:"\u0412\u044a\u0432\u0435\u0434\u0435\u043d\u0438\u044f\u0442 \u0435\u043c\u0430\u0439\u043b \u043a\u043e\u0434 \u043d\u0435 \u0441\u044a\u0432\u043f\u0430\u0434\u0430",phoneCode:"\u0412\u044a\u0432\u0435\u0434\u0435\u043d\u0438\u044f\u0442 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0435\u043d \u043a\u043e\u0434 \u043d\u0435 \u0441\u044a\u0432\u043f\u0430\u0434\u0430",emailphoneCode:"\u0412\u044a\u0432\u0435\u0434\u0435\u043d\u0438\u0442\u0435 \u043a\u043e\u0434\u043e\u0432\u0435 \u0437\u0430 \u0435\u043c\u0430\u0438\u043b \u0438 \u0442\u0435\u043b\u0435\u0444\u043e\u043d \u043d\u0435 \u0441\u044a\u0432\u043f\u0430\u0434\u0430\u0442",
refData:{Title:"\u0417\u0430\u0433\u043b\u0430\u0432\u0438\u0435",Desc:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",Supported:"\u041f\u043e\u0434\u043a\u0440\u0435\u043f\u0438\u043b\u0438",Attach:"\u041f\u0440\u0438\u043a\u0430\u0447\u0435\u043d \u0444\u0430\u0439\u043b",AttachEmpty:"\u041d\u044f\u043c\u0430"},connecting:{waitconfirmcodes:"\u041c\u043e\u043b\u044f \u0438\u0437\u0447\u0430\u043a\u0430\u0439\u0442\u0435 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0430",waitloading:"\u041c\u043e\u043b\u044f \u0438\u0437\u0447\u0430\u043a\u0430\u0439\u0442\u0435 \u0437\u0430\u0440\u0435\u0436\u0434\u0430\u043d\u0435"}},
title:"\u0420\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c \u0437\u0430 \u0411\u044a\u043b\u0433\u0430\u0440\u0438\u044f",websocket:{supported:false,timing:2E3,counter:0},ariaBtn:{btnNewRef:"\u0421\u044a\u0437\u0434\u0430\u0439 \u043d\u043e\u0432 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c",btnSupRef:"\u041f\u043e\u0434\u043a\u0440\u0435\u043f\u0438 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c",btnNewRefRegRem:{reg:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0430\u0439 \u043d\u043e\u0432\u0438\u044f\u0442 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c",
rem:"\u0414\u0435\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0430\u0439 \u0440\u0435\u0444\u0435\u0440\u0435\u043d\u0434\u0443\u043c\u044a\u0442"},btnNewRefFinal:""},offlineMessage:{id:"offLineID",v:"\u041c\u043e\u043b\u044f \u0438\u0437\u0447\u0430\u043a\u0430\u0439\u0442\u0435 \u0437\u0430 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442 \u0432\u0440\u044a\u0437\u043a\u0430"}};var engUSA={fieldsRefTitle:{f:"Referendum title",r:"Please enter referendum title",v:"",h:true,l:6},fieldsRefGoals:{f:"Short description of the goals and ideas for this referendum",
r:"Please shortly describe the goals and ideas for this referendum",v:"",h:true,l:10},fieldsRefFirstName:{f:"First name",r:"Please enter your first name, it will be encrypted",v:"",h:true,l:0},fieldsRefLastName:{f:"Last name",r:"Please enter your last name, it will be encrypted",v:"",h:true,l:0},fieldsRefEmail:{f:"Your email",r:"Please enter your email, it will be encrypted",v:"",h:true,t:"e",s:false,l:6},fieldsRefPhone:{f:"Your mobile phone",r:"Please enter your mobile phone, it will be encrypted",
v:"",h:true,t:"s",s:false,l:6},fieldsRefEmailConfirm:{f:"Enter 4 digits code sent to email",r:"Entered code does not match",v:"",h:true,c:false,l:3},fieldsRefPhoneConfirm:{f:"Enter 4 digits code sent to phone",r:"Entered code does not match",v:"",h:true,c:false,l:3},fieldsRefLoadedFile:{f:"Upload a file",r:"",v:"",h:true,c:false,s:false},fileReferendum:{f:"Upload file",h:true},registerRef:{f:"Register referendum",r:false,h:true,ff:"Remove referendum"},windowTimeOpen:commonDataTimeOpen,phoneExtension:"001",
country:"usa",abrv:"usa",beggingCountry:"Referendum - USA",createRef:"New referendum",supportRef:{f:"Support referendum",r:false,h:true,ff:"Redraw support"},loadFile:{l:"Load",s:"Save",r:"Remove",c:"Change"},genericWords:{invalidEmail:"You will neeed a real email",emailMe:"There was a problem with the server, please try few more times and if this message persists, email unitedallpeople@gmail.com and referendum will be registered or supported from you name",emailSupport:"unitedallpeople@gmail.com",
messageSMS:"please used code - codereplace - to confirm your phone",messageEmail:"please used code - codereplace - to confirm your email",messageEmailSubject:"Your email confirmation code",fieldLoadingFile:"Attach file",strg:"referendum",loading:"Loading...",deleteing:"Deleting...",downloading:"Downloading...",checking:"Checking...",emailCode:"Entered email code does not match",phoneCode:"Entered phone code does not match",emailphoneCode:"Entered email and phone codes do not match",refData:{Title:"Title",
Desc:"Description",Supported:"Supported by",Attach:"Attached File",AttachEmpty:"None"},connecting:{waitconfirmcodes:"Please wait confirming the codes",waitloading:"Please wait loading"}},title:"Referendum for USA",websocket:{supported:false,timing:2E3,counter:0},ariaBtn:{btnNewRef:"Create new referendum",btnSupRef:"Support referendum",btnNewRefRegRem:{reg:"Register the new referendum",rem:"Remove the newly registered referendum"},btnNewRefFinal:""},offlineMessage:{id:"offLineID",v:"Please wait for internet connection"}};
var additionalTracking={fileSaved:false,azr:""};engUSA.track=additionalTracking;bg.track=additionalTracking;return function(lang){switch(lang){case "English USA":return engUSA;break;case "\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438":return bg;break;default:return bg}}});
bgr.factory("normalizePhone",function(){String.prototype.replaceAll=function(str1,str2,ignore){return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),ignore?"gi":"g"),typeof str2=="string"?str2.replace(/\$/g,"$$$$"):str2)};return function(e,c){var phone=e.trim();phone=phone.replaceAll("-","").replaceAll("+","").replaceAll("/","").replaceAll(".","").replaceAll(":","").replaceAll("\\","").replaceAll("|","");switch(c){case "bulgaria":var d1=phone.charAt(0);
var d2=phone.substring(0,2);var d3=phone.substring(0,3);var d5=phone.substring(0,5);var addB="+359";if(d5=="00359")phone=phone.replace("00359","+359");else if(d3=="359")phone="00"+phone;else if(d2=="00")phone=addB+phone.substring(2,phone.length);else if(d1=="0")phone=addB+phone.substring(1,phone.length);else phone=addB+phone;case "usa":var addB="+1";var d1=phone.charAt(0);var d2=phone.substring(0,2);var d3=phone.substring(0,3);if(d3=="001")phone=phone.replace("001","+1");else if(d1=="1")phone="00"+
phone;else phone=addB+phone;break;default:break}return phone}});bgr.factory("initializedSystemFactory",function(){return function(iam){var obj;iam.words.registerRef.h=true;iam.urlFile="";Object.keys(obj=iam.words).forEach(function(key,index){if(index!==0&&index<=8){obj[key].h=true;obj[key].v=""}})}});
bgr.factory("focusNewReferendumFactory",function(){return function(item,ni,ll,iam,timeout,page){exitFocusNewRef:{if(ni===6){if(page==="Y")iam.words.fieldsRefEmail.v=$("#fieldsRefEmail").val();if(iam.words.fieldsRefEmail.v.indexOf("@")===-1||iam.words.fieldsRefEmail.v.indexOf(".")===-1||iam.words.fieldsRefEmail.v.indexOf("@")-iam.words.fieldsRefEmail.v.indexOf(".")===1||iam.words.fieldsRefEmail.v.indexOf("@")-iam.words.fieldsRefEmail.v.indexOf(".")===-1){$("#fieldsRefEmail").val("");$("#fieldsRefEmail").attr("placeholder",
iam.words.genericWords.invalidEmail);timeout(function(){$("#fieldsRefEmail").select();iam.words.fieldsRefPhone.h=true});break exitFocusNewRef}}var l=0;if(typeof item!=="undefined"){l=item.toString().length;if(l>ll)Object.keys(obj=iam.words).forEach(function(key,index){if(index==ni){var nextKey=Object.keys(obj)[ni];obj[nextKey].h=false}})}}}});
bgr.factory("trackChangesFactory",function(){return function(item,ni,ll,cw,iam,timeout){if(ni===6){if(iam.words.fieldsRefEmail.v.indexOf("@")===-1||iam.words.fieldsRefEmail.v.indexOf(".")===-1||iam.words.fieldsRefEmail.v.indexOf("@")-iam.words.fieldsRefEmail.v.indexOf(".")===1||iam.words.fieldsRefEmail.v.indexOf("@")-iam.words.fieldsRefEmail.v.indexOf(".")===-1){$("#fieldsRefEmail").val("");$("#fieldsRefEmail").attr("placeholder",iam.words.genericWords.invalidEmail);timeout(function(){$("#fieldsRefEmail").select();
Object.keys(obj=iam.words).forEach(function(key,index){if(index>=ni){var nextKey=Object.keys(obj)[index];obj[nextKey].h=true;iam.urlFile=""}})})}}else if(ni===7){var l$0;if(typeof item==="undefined")l$0=0;else l$0=item.toString().length;if(l$0===ll+1)timeout(function(){$("#fieldsRefPhoneConfirm").select()})}var l=0;if(typeof item==="undefined"){l=0;Object.keys(obj=iam.words).forEach(function(key,index){if(index>=ni){var nextKey=Object.keys(obj)[index];obj[nextKey].h=true}})}else{l=item.toString().length;
if(l>ll)Object.keys(obj=iam.words).forEach(function(key,index){if(ni===8&&index===7){if(l===ll+1){iam.words.fieldsRefPhoneConfirm.v=$("#fieldsRefPhoneConfirm").val();if(cw==="Y"){var p=new Promise(function(resolve,reject){resolve(iam.confirmCode(cw))});p.then(function(result){},function(err){})}else iam.words.registerRef.h=false}}else if(ni===6)if(iam.words.fieldsRefEmail.v.indexOf("@")===-1&&iam.words.fieldsRefEmail.v.indexOf(".")===-1||iam.words.fieldsRefEmail.v.indexOf("@")-iam.words.fieldsRefEmail.v.indexOf(".")===
1||iam.words.fieldsRefEmail.v.indexOf("@")-iam.words.fieldsRefEmail.v.indexOf(".")===-1){$("#fieldsRefEmail").val("");$("#fieldsRefEmail").attr("placeholder",iam.words.genericWords.invalidEmail);timeout(function(){$("#fieldsRefEmail").select();Object.keys(obj=iam.words).forEach(function(key,index){if(index>=ni){var nextKey=Object.keys(obj)[index];obj[nextKey].h=true;iam.urlFile=""}})})}if(index===ni){var nextKey=Object.keys(obj)[ni];obj[nextKey].h=false}});else Object.keys(obj=iam.words).forEach(function(key,
index){if(index>ni-1){var nextKey=Object.keys(obj)[index];obj[nextKey].h=true}})}}});
bgr.factory("updateNewReferendumFactory",function(){return function(e,id,iam,normalizePhone,caching,timeout,globalVariables){iam.words[e.currentTarget.id].v=e.currentTarget.value.toString();var tabPressed=false;$("body").on("keyup",function(e){if(e.which===9)tabPressed=true;else tabPressed=false});outer:switch(e.currentTarget.id){case "fieldsRefTitle":if(iam.words["fieldsRefGoals"].h===true&&e.currentTarget.value==="")timeout(function(){$("#"+e.currentTarget.id).select()});else timeout(function(){$("#fieldsRefGoals").select()});
break outer;case "fieldsRefGoals":if(iam.words["fieldsRefFirstName"].h===true&&e.currentTarget.value==="")timeout(function(){$("#"+e.currentTarget.id).select()});else timeout(function(){$("#fieldsRefFirstName").select()});break outer;case "fieldsRefFirstName":if(iam.words["fieldsRefLastName"].h===true&&e.currentTarget.value==="")timeout(function(){$("#"+e.currentTarget.id).select()});else timeout(function(){$("#fieldsRefLastName").select()});iam.person.firstName=e.currentTarget.value;break outer;
case "fieldsRefLastName":if(iam.words["fieldsRefEmail"].h===true&&e.currentTarget.value==="")timeout(function(){$("#"+e.currentTarget.id).select()});else timeout(function(){$("#fieldsRefEmail").select()});iam.person.lastName=e.currentTarget.value;break outer;case "fieldsRefEmail":if(iam.words.fieldsRefEmail.v.indexOf("@")!==-1&&iam.words.fieldsRefEmail.v.indexOf(".")!==-1&&iam.words.fieldsRefEmail.v.indexOf("@")-iam.words.fieldsRefEmail.v.indexOf(".")!==1&&iam.words.fieldsRefEmail.v.indexOf("@")-
iam.words.fieldsRefEmail.v.indexOf(".")!==-1){iam.person.email=e.currentTarget.value;iam.sendEmail()}break outer;case "fieldsRefPhone":iam.person.phone=normalizePhone(e.currentTarget.value,iam.words.country);iam.sendSMS();caching.setCache(globalVariables.getProperty(1,"storage","type"),globalVariables.getProperty(1,"storage","name"),iam.person,"object");break outer;default:break outer}}});
bgr.factory("registerReferendumFactory",function(){return function(iam,postURLData,globalVariables,normalizePhone,timeout){iam.isVisibleSR=false;var caller="";if(!iam.words.registerRef.r){caller="reg";iam.dynamicButtons.regRef=iam.words.registerRef.ff;iam.words.ariaBtn.btnNewRefFinal=iam.words.ariaBtn.btnNewRefRegRem.rem}else{caller="unr";iam.dynamicButtons.regRef=iam.words.registerRef.f;iam.words.ariaBtn.btnNewRefFinal=iam.words.ariaBtn.btnNewRefRegRem.reg}iam.words.registerRef.r=!iam.words.registerRef.r;
var d={Title:iam.words.fieldsRefTitle.v,Description:iam.words.fieldsRefGoals.v,fn:iam.words.fieldsRefFirstName.v,ln:iam.words.fieldsRefLastName.v,Email:iam.words.fieldsRefEmail.v,Phone:normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country),AttachmentStr:iam.words.fieldsRefLoadedFile.v,sfn:iam.words.fieldsRefFirstName.v,sln:iam.words.fieldsRefLastName.v,sEmail:iam.words.fieldsRefEmail.v,sPhone:normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country),tbl:"ref"+iam.words.abrv,Caller:caller};
postURLData(globalVariables.getProperty(0,"postReferendumsInfo").url,d,globalVariables.getProperty(0,"postReferendumsInfo").contentType).then(function(response){if(response==="f"){iam.dynamicButtons.regRef=iam.words.registerRef.f;iam.urlRef="Views/emailme.html"}else if(response==="x")iam.dynamicButtons.regRef=iam.words.registerRef.f;else iam.dynamicButtons.regRef=iam.words.registerRef.ff;console.log("Calling SignalR hub which will redistribute all referendums plus the newly registered one and it will update the front end of all users");
iam.hub.server.send(iam.words.abrv)})["catch"](function(error){})}});bgr.factory("uploadFileFactory",function(){return function(http,ngDialog){http.post(iam.serverCalls.webAPI+iam.serverCalls.uploadFile,f).success(function(data,status,headers,config){}).error(function(data,status,headers,config){iam.urlRef="Views/emailme.html"})}});
bgr.factory("confirmCodeFactory",function(){return function(iam,http,ngDialog,normalizePhone,cw){exit:{if(cw==="Y"){iam.words.track.azr="https://allpeopleunited.blob.core.windows.net/usareferendum?sv=2015-04-05&ss=bfqt&srt=sco&sp=rwdlacup&se=2017-12-31T00:48:51Z&st=2016-10-18T16:48:51Z&spr=https&sig=W%2FPGfyK%2BuMF0yZo%2Bsdi%2FOq6Nv0lrXT2nSxCLq6XkqvU%3D";iam.urlFile="Views/LoadingFile.html";iam.words.registerRef.h=false}break exit;var d$1=iam.words.abrv+"|"+iam.words.fieldsRefFirstName.v+" "+iam.words.fieldsRefLastName.v+
"|"+iam.words.fieldsRefEmail.v+"|"+normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country)+"|"+iam.words.fieldsRefEmailConfirm.v+"|"+iam.words.fieldsRefPhoneConfirm.v;var dialog=ngDialog.open({template:'<h3><center><img src="Images/l0.gif"> '+iam.words.genericWords.connecting.waitconfirmcodes+"</center></h3>",plain:true,showClose:false,overlay:true,cache:false,preserveFocus:true,trapFocus:true,ariaAuto:true,ariaRole:"loading",ariaLabelledById:"idloading",closeByDocument:false,closeByEscape:false});
http.post(iam.serverCalls.webAPI+iam.serverCalls.getSAA,d$1).success(function(data,status,headers,config){if(data.length>1){ngDialog.closeAll();if(cw==="Y"){iam.words.track.azr=data;iam.words.registerRef.h=false}}else iam.urlRef="Views/emailme.html"}).error(function(data,status,headers,config){iam.urlRef="Views/emailme.html"})}}});
bgr.factory("getReferendumInformationFactory",function(){return function(iam,http){var r=[];http.post(iam.serverCalls.webAPI+iam.serverCalls.getRI,iam.words.abrv).success(function(data,status,headers,config){r=data}).error(function(data,status,headers,config){r=data});return r}});
bgr.factory("voteForRefFactory",function(){return function(i,l,iam,postURLData,ngDialog,normalizePhone,caching,globalVariables){iam.words.fieldsRefGoals.v=iam.words.referendumSelected.description;iam.words.fieldsRefTitle.v=iam.words.referendumSelected.title;iam.words.fieldsRefLoadedFile.v=$("#fieldsRefLoadedFile").val();iam.person=caching.getCache(globalVariables.getProperty(1,"storage","type"),"person","object");iam.words.fieldsRefFirstName.v=iam.person.firstName;iam.words.fieldsRefLastName.v=iam.person.lastName;
iam.words.fieldsRefEmail.v=iam.person.email;iam.words.fieldsRefPhone.v=iam.person.phone;if(l===1){iam.words.referendumSelected=iam.words.referendumsAll[i];iam.words.referendumSelected.id=i;var c=$("#supportRefBtn"+i).html().trim();if(c===iam.words.supportRef.f)var dialog=ngDialog.openConfirm({template:"voteForReferendum",className:"ngdialog-theme-default",closeByDocument:false,scope:iam});else{d={Title:iam.words.referendumSelected.title,Description:iam.words.referendumSelected.description,fn:iam.words.fieldsRefFirstName.v,
ln:iam.words.fieldsRefLastName.v,Email:iam.words.fieldsRefEmail.v,Phone:normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country),AttachmentStr:"",sfn:iam.words.fieldsRefFirstName.v,sln:iam.words.fieldsRefLastName.v,sEmail:iam.words.fieldsRefEmail.v,sPhone:normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country),tbl:"ref"+iam.words.abrv,Caller:"unv"};$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.f);postURLData(globalVariables.getProperty(0,"postReferendumsInfo").url,
d,globalVariables.getProperty(0,"postReferendumsInfo").contentType).then(function(response){if(response==="t")$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.ff);else if(response==="x")$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.f);else{$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.f);iam.urlRef="Views/emailme.html"}console.log("Calling SignalR hub which will redistribute all referendums plus the newly casted vote or redrawn vote and it will update the front end of all users");
iam.hub.server.send(iam.words.abrv)})["catch"](function(error){iam.urlRef="Views/emailme.html"})}}else{var p=new Promise(function(resolve,reject){resolve(iam.confirmCode("N"))});p.then(function(result){d={Title:iam.words.fieldsRefTitle.v,Description:iam.words.fieldsRefGoals.v,fn:iam.words.fieldsRefFirstName.v,ln:iam.words.fieldsRefLastName.v,Email:iam.words.fieldsRefEmail.v,Phone:normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country),AttachmentStr:"",sfn:iam.words.fieldsRefFirstName.v,sln:iam.words.fieldsRefLastName.v,
sEmail:iam.words.fieldsRefEmail.v,sPhone:normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country),tbl:"ref"+iam.words.abrv,Caller:"vot"};ngDialog.closeAll();$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.ff);postURLData(globalVariables.getProperty(0,"postReferendumsInfo").url,d,globalVariables.getProperty(0,"postReferendumsInfo").contentType).then(function(response){if(response==="t")$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.ff);
else if(response==="x")$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.f);else{$("#supportRefBtn"+iam.words.referendumSelected.id).html(iam.words.supportRef.f);iam.urlRef="Views/emailme.html"}console.log("Calling SignalR hub which will redistribute all referendums plus the newly casted vote and it will update the front end of all users");iam.hub.server.send(iam.words.abrv)})["catch"](function(error){iam.urlRef="Views/emailme.html"})},function(err){iam.urlRef="Views/emailme.html"})}}});
bgr.factory("sendSMSFactory",function(){return function(iam,http,ngDialog){brSMS:{break brSMS;var d$2=iam.words.abrv+"|s|"+iam.words.fieldsRefFirstName.v+" "+iam.words.fieldsRefLastName.v+"|"+normalizePhone(iam.words.fieldsRefPhone.v,iam.words.country)+"|"+iam.words.genericWords.messageSMS;http.post(iam.serverCalls.webAPI+iam.serverCalls.sendCode,d$2).success(function(data,status,headers,config){if(data!=="f");else iam.urlRef="Views/emailme.html"}).error(function(data,status,headers,config){iam.urlRef=
"Views/emailme.html"})}}});
bgr.factory("sendEmailFactory",function(){return function(url){brEmail:{break brEmail;var d$3=iam.words.abrv+"|e|"+iam.words.fieldsRefFirstName.v+" "+iam.words.fieldsRefLastName.v+"|"+iam.words.fieldsRefEmail.v+"|"+iam.words.genericWords.messageEmail+"|"+iam.words.genericWords.messageEmailSubject;http.post(iam.serverCalls.webAPI+iam.serverCalls.sendCode,d$3).success(function(data,status,headers,config){if(data!=="f");else iam.urlRef="Views/emailme.html"}).error(function(data,status,headers,config){iam.urlRef=
"Views/emailme.html"})}}});
bgr.factory("caching",function(){return{setCache:function(s,k,v,type){c:{var t=type.toLowerCase().trim();if(s==="sessionStorage"||s==="localStorage")if(typeof window[s]!=="undefined"){if(typeof window[s][k]!=="undefined")window[s].removeItem(k);if(t==="object"||t==="array")window[s].setItem(k,JSON.stringify(v));else window[s].setItem(k,v);break c}else return false}},getCache:function(s,k,type){var t=type.toLowerCase().trim();c:if(typeof window[s][k]!=="undefined"){if(t==="object"||t==="array")return JSON.parse(window[s][k]);
else return window[s][k];break c}else{return false;break c}}}});
bgr.factory("signalRHub",function(){return function(iam,c,gv,caching){if(c===2){var server=gv["server"];$.connection.hub.url=server+gv["hub"];var hubProxy=$.connection.hub.proxies.referendumhub;iam.hub=hubProxy;hubProxy.client.broadcastMessage=function(r){console.log("Below is the information that is received from SignalR hub, the message that was broadcated to all users");console.log("This stringified JSON object is all registered referendums");console.log(r);iam.words.referendumSelected={};iam.words.referendumSelected.id=
-1;iam.words.referendumsAll=JSON.parse(r);iam.$apply()};$.connection.hub.start().done(function(){hubProxy.server.send(iam.words.country);iam.$apply()})}}});

var bgrCtrl=bgr.controller("bgrCtrl",["$window","$scope","$http","$location","$rootScope","$timeout","$route","$interval","ngDialog","words","normalizePhone","trackChangesFactory","focusNewReferendumFactory","initializedSystemFactory","updateNewReferendumFactory","registerReferendumFactory","uploadFileFactory","confirmCodeFactory","voteForRefFactory","sendSMSFactory","sendEmailFactory","getReferendumInformationFactory","caching","globalVariables","signalRHub","getURLData","postURLData",function($window,
$scope,$http,$location,$rootScope,$timeout,$route,$interval,ngDialog,words,normalizePhone,trackChangesFactory,focusNewReferendumFactory,initializedSystemFactory,updateNewReferendumFactory,registerReferendumFactory,uploadFileFactory,confirmCodeFactory,voteForRefFactory,sendSMSFactory,sendEmailFactory,getReferendumInformationFactory,caching,globalVariables,signalRHub,getURLData,postURLData){if(typeof $scope.words==="undefined"){$scope.words=words("English USA");$scope.urlFile="";$scope.$watch(function(scope){return scope.online},
function(newValue,oldValue){if(!newValue){ngDialog.closeAll();$("#loadFile").removeClass("form-control ");$scope.urlRef="Views/offline.html";$scope.supRefReady=true;$timeout(function(){var e=$("#offline");if(e)e.focus();e.selector.select},1E3)}else{$("#loadFile").removeClass("form-control ");$scope.urlRef="";$scope.supRefReady=false}});globalVariables.setProperty(0,globalVariables.getProperty(0,"WebSocketCounter")+1,"WebSocketCounter");signalRHub($scope,globalVariables.getProperty(0,"WebSocketCounter"),
globalVariables.getObject(),caching);caching.setCache(globalVariables.getProperty(1,"storage","type"),globalVariables.getProperty(1,"storage","name"),globalVariables.getProperty(0,"person"),"object");$scope.person=globalVariables.getProperty(0,"person");if(typeof $scope.hub!=="undefined"){console.log("Initilizing SignalR here once connection is established is propagated accross all active users");console.log("Below is the connection to the SignalR hub, which has the task to propage the information to all users");
console.log($scope.hub)}$scope.words.ariaBtn.btnNewRefFinal=$scope.words.ariaBtn.btnNewRefRegRem.reg;$scope.words.referendumsAll=[];$scope.dynamicButtons={};$scope.dynamicButtons.regRef=$scope.words.registerRef.f;$scope.dynamicButtons.supRef=$scope.words.supportRef.f;$scope.dynamicButtons.supRefFinal=$scope.words.supportRef.f;$scope.words.fieldsRefTitle.h=false;$(":file").filestyle({input:true});$(":file").filestyle({buttonBefore:true});$scope.initializedSystem=function(){initializedSystemFactory($scope)};
$scope.focusNewReferendum=function(item,ni,ll,page){focusNewReferendumFactory(item,ni,ll,$scope,$timeout,page)};$scope.updateNewReferendum=function(e,id){updateNewReferendumFactory(e,id,$scope,normalizePhone,caching,$timeout,globalVariables)};$scope.trackChanges=function(item,ni,ll,cw){trackChangesFactory(item,ni,ll,cw,$scope,$timeout)};$scope.registerReferendum=function(){var step1=function(func,delay){var promise=new Promise(function(resolve,reject){setTimeout(function(){resolve(func)},delay)});
return promise};step1(registerReferendumFactory($scope,postURLData,globalVariables,normalizePhone,$timeout),0).then(function(){})["catch"](function(error){})};$scope.uploadFile=function(f){uploadFileFactory($http,ngDialog)};$scope.confirmCode=function(cw){confirmCodeFactory($scope,$http,ngDialog,normalizePhone,cw)};$scope.sendSMS=function(){};$scope.sendEmail=function(){};$scope.newRef=function(){$scope.initializedSystem();$timeout(function(){$("#fieldsRefTitle").focus()});$scope.urlFile="";$scope.urlRef=
"Views/NewReferendum.html"};$scope.supportRef=function(){$scope.initializedSystem();$scope.urlFile="";$("#loadFile").removeClass("form-control ");$scope.urlRef="Views/SupportReferendum.html"};$scope.voteForRef=function(i,l){var step1=function(func,delay){var promise=new Promise(function(resolve,reject){setTimeout(function(){resolve(func)},delay)});return promise};var step2=function(func,delay){var promise=new Promise(function(resolve,reject){setTimeout(function(){resolve(func)},delay)});return promise};
step1($scope.initializedSystem(),0).then(step2(voteForRefFactory(i,l,$scope,postURLData,ngDialog,normalizePhone,caching,globalVariables),0))}}}]);

(function(){if(typeof window["caches"]!=="undefined"&&"serviceWorker"in navigator){navigator.serviceWorker.register("swLoad.min.js",{scope:"/"}).then(function(registration){})["catch"](function(error){console.log(error)});navigator.serviceWorker.ready.then(function(registration){})}})();
